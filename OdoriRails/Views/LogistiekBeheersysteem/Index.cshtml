@using OdoriRails.Models.LogistiekBeheer
@model OdoriRails.Models.LogistiekBeheer.LogistiekBeheerModel

<div class="container">
<div class="col-md-4 pull-left">
<div class="panel panel-default" style="margin-top: 10px">
    <div class="panel-heading">
        @Html.ActionLink("Main", "SetStateMain", null, new { @class = "btn btn-md btn-primary" })
        @Html.ActionLink("Edit", "SetStateEdit", null, new { @class = "btn btn-md btn-primary" })
        @Html.ActionLink("Delete", "SetStateDelete", null, new { @class = "btn btn-md btn-primary" })
        @Html.ActionLink("Simulation", "SetStateSimulation", null, new { @class = "btn btn-md btn-primary" })
    </div>
</div>
@if (Model.State == LogistiekState.Main)
{
    using (Html.BeginForm("LockTrack", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Lock/Unlock Track")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Track Numbers:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TrackNumbers)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Sector Numbers:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.SectorNumbers)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Lock:") @Html.RadioButtonFor(m => m.Form.RadioButton, new { id = 0 }, true)
                        </td>
                        <td>
                            @Html.Label("Unlock:") @Html.RadioButtonFor(m => m.Form.RadioButton, new { id = 0 }, true)
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
    using (Html.BeginForm("MoveTram", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Move Tram")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Tram Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TramNumber, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Track Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TrackNumber, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Sector Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.SectorNumber, new { type = "number" })
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
    using (Html.BeginForm("ToggleDisabled", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Disable/Enable Tram")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Tram Numbers:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TramNumbers)
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
}
else if (Model.State == LogistiekState.Edit)
{
    using (Html.BeginForm("AddTram", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Add Tram")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Tram Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TramNumber, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Default Line:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.DefaultLine, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Tram Model:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TramModel)
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
    using (Html.BeginForm("AddTrack", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Add Track")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Track Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TrackNumber, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Track Type:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TrackType)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Default Line:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.DefaultLine, new { type = "number" })
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
    using (Html.BeginForm("AddSector", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Add Sector")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Track Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TrackNumber, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Latitude:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.Latitude, new { type = "number" })
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.Label("Longitude")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.Longitude, new { type = "number" })
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
}
else
{
    using (Html.BeginForm("DeleteTram", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Delete Tram")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Tram Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TramNumber, new { type = "number" })
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
    using (Html.BeginForm("DeleteTrack", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Remove Track")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Track Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.TrackNumber, new { type = "number" })
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
    using (Html.BeginForm("DeleteSector", "LogistiekBeheersysteem", FormMethod.Post))
    {
        <div class="panel panel-default" style="margin-top: -10px">
            <div class="panel-heading">
                @Html.Label("Remove Last Sector")
                <button type="submit" class="btn btn-md btn-primary pull-right" style="margin-top: -5px">Confirm</button>
            </div>
            <div class="panel-body">
                <table>
                    <tr>
                        <td>
                            @Html.Label("Track Number:")
                        </td>
                        <td>
                            @Html.TextBoxFor(m => m.Form.SectorNumber, new { type = "number" })
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    }
}
</div>
    
<div class="col-md-8"> 
    <div style="border-radius: 4px; margin-top: 10px; height: 800px; width: 100%;" id="map"></div>
</div>
</div>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script>
    var map;
    var markers;
    function initMap() {

        var myStyle = [
            {
                featureType: "administrative",
                elementType: "labels",
                stylers: [
                    { visibility: "off" }
                ]
            }, {
                featureType: "poi",
                elementType: "labels",
                stylers: [
                    { visibility: "off" }
                ]
            }, {
                featureType: "water",
                elementType: "labels",
                stylers: [
                    { visibility: "off" }
                ]
            }, {
                featureType: "road",
                elementType: "labels",
                stylers: [
                    { visibility: "off" }
                ]
            }
        ];

        var markersArray = [];
        var oldJson;

        console.log("initmap...");
        map = new google.maps.Map(document.getElementById('map'),
            {
            mapTypeControlOptions: {
                mapTypeIds: ['myStyle', google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.TERRAIN]
            },
            center: { lat: 52.348012, lng: 4.852770 },
            zoom: 18,
            draggable: true,
            scrollwheel: false,
            navigationControl: false,
            mapTypeControl: false,
            scaleControl: false,
            zoomControl: false,
            streetViewControl: false,
            mapTypeId: 'myStyle'
            });

        map.mapTypes.set('myStyle', new google.maps.StyledMapType(myStyle, { name: 'My Style' }));

        var contentString;

        var infowindowold;

        var textBox = document.getElementById('Form_TramNumber');

        function addMarker(location, map, labeltext, contentString) {
            var marker;
            console.log("adding Marker!");
            // Add the marker at the clicked location, and add the next-available label
            // from the array of alphabetical characters.
            marker = new google.maps.Marker({
                position: location,
                label: labeltext,
                map: map,
                icon: "../../fonts/Icons/TransparantIcon16.gif"
            });
            marker.addListener('click', function () {
                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                });
                if (infowindowold) {
                    infowindowold.close();
                }
                infowindow.open(map, marker);
                textBox.value = parseInt(marker.label);
                infowindowold = infowindow;
            });
            markersArray.push(marker);
        }
        //var coordinates = { lat: 52.348012, lng: 4.852770 };
        //addMarker(coordinates, map);

        var requestMethod = function (data) {
            if (oldJson !== data) {
                for (var i = 0; i < data.length; i++) {
                    var lat = parseFloat(data[i].Latitude);
                    var lng = parseFloat(data[i].Longitude);
                    var location = { lat, lng };
                    console.log(String(data[i].TramNumber));
                    console.log(location);
                    contentString = '<div id="content">' +
                        '<div id="siteNotice">' +
                        '</div>' +
                        '<h1 id="firstHeading" class="firstHeading">' +
                        String(data[i].TramNumber) +
                        '</h1>' +
                        '<div id="bodyContent">' +
                        '<p>Tracknumber: ' +
                        String(data[i].TrackNumber) +
                        '</p>' +
                        '<p>Tracktype: ' +
                        String(data[i].TrackType) +
                        '</p>' +
                        '<p>Sectornumber: ' +
                        String(data[i].SectorNumber) +
                        '</p>' +
                        '<p>Line: ' +
                        String(data[i].Line) +
                        '</p>' +
                        '</div>' +
                        '</div>';
                    addMarker(location, map, String(data[i].TramNumber), contentString);
                    oldJson = data;
                }
            }
        }

        var documentReady = function () {
            $.getJSON('/api/GoogleMapsAPI').done(requestMethod);
            console.log("json read!");
            map.clearOverlays();
            }

        google.maps.Map.prototype.clearOverlays = function () {
            for (var i = 0; i < markersArray.length; i++) {
                markersArray[i].setMap(null);
            }
            markersArray.length = 0;
        }

        var myVar = setInterval(myTimer, 5000);

        function myTimer() {
            documentReady();
        }

        $(document).ready(documentReady());
    }


    
</script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4qb6olqxSBOg_yeccMF6MFjzNf9RCZ9s&callback=initMap"></script>